# 这些年背过的面试题——架构设计篇（重点总结）

## 一、社区系统架构

- **系统拆分**：使用DDD领域模型拆分成多个微服务，注重服务的扇出和扇入设计。
- **缓存策略**：
  - CDN、Nginx静态缓存、JVM缓存。
  - Redis Cluster用于提高读写性能，每个节点QPS可达5万。
- **消息队列（MQ）**：用于微服务系统解耦，异步调用，应对高并发写请求。
- **分库分表与读写分离**：提高数据库并发处理能力。
- **ElasticSearch**：用于查询、统计和全文搜索。

## 二、商城系统-亿级商品存储

- **分库分表**：基于Hash取模、一致性Hash实现。
- **缓存策略**：多级缓存应对热key问题。
- **热key处理**：业务场景进行range分片，打散热点范围下的子key。

## 三、对账系统-分布式事务一致性

- **最终一致性**：基于MQ的可靠消息投递机制。
- **最大努力通知方案**：基于重试加确认。
- **避免分布式事务**：单进程用数据库事务，跨进程用消息队列。

## 四、用户系统-多线程数据割接

- **线程安全**：避免线程间数据错乱和重复处理。
- **解决方案**：深拷贝List作为参数传入子线程，确保子线程执行完后再进行clear。

## 五、秒杀系统场景设计

- 设计细节将在后续篇幅中详细描述。

## 六、统计系统-海量计数

- **中小规模**：缓存+DB存储方案。
- **大型互联网**：全部存储在Redis中，通过hash分拆提升写性能。
- **亿级规模**：定制数据结构，共享key紧凑存储。

## 七、系统设计 - 微软

- **需求收集**：确定使用对象、服务场景、用户量级。
- **顶层设计**：核心功能包括写功能、读功能、交互。
- **系统核心指标**：性能和延迟、可扩展性和吞吐量、可用性和一致性。
- **数据存储**：包括键值存储、文档存储、分词倒排、列型存储、图形存储、多媒体存储。

## 八、如何设计一个微博

- **核心功能**：Post a Tweet，Timeline，News Feed，Follow/Unfollow a user，Register/Login。
- **QPS承载**：根据QPS选择合适的服务器和架构。
- **微服务拆分**：根据服务功能进行拆分。
- **数据表设计**：设计合理的数据表结构以支持系统功能。