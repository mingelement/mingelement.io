# 这些年背过的面试题——分布式篇

## 导读

本文详细介绍了分布式系统的基础知识，包括发展历程、CAP原则、一致性、可用性、分区容错性、分布式事务等，是技术人面试系列的一部分。

## 分布式系统的发展历程

1. **入口级负载均衡**：包括网关负载均衡和客户端负载均衡。
2. **单应用架构**：应用服务和数据服务分离，应用服务集群，应用服务中心化SAAS。
3. **数据库主备读写分离**：包括全文搜索引擎、缓存集群、分布式消息中间件、数据库水平拆分和垂直拆分。
4. **划分上下文拆分微服务**：涉及服务注册发现、配置动态更新、业务灰度发布、统一安全认证、服务降级限流、接口检查监控和服务全链路追踪。

## CAP原则

- **一致性**（Consistency）：包括强一致性、弱一致性、单调读一致性和最终一致性。
- **可用性**（Availability）：包括多级缓存和读写分离。
- **分区容忍性**（Partition tolerance）：一致性Hash解决扩缩容问题。

## 一致性

- **XA方案**：包括2PC和3PC协议。
- **Paxos算法**：在一个发生异常的分布式系统中快速且正确地在集群内部对某个数据的值达成一致。
- **Raft算法**：管理复制日志的一致性算法。

## 可用性

- **心跳检测**：以固定频率向其他节点汇报当前节点状态的方式。
- **多机房实时热备**：提升性能和可用性，但资源成本上升。

## 分区容错性

分布式系统对于错误包容的能力，通过限流、降级、兜底、重试、负载均衡等方式增强系统的健壮性。

## 分布式事务

- **XA方案**：两阶段提交和三阶段提交。
- **TCC方案**：Try Confirm Cancel / 短事务。
- **Saga方案**：事务性补偿 / 长事务。
- **本地消息表**：如eBay的实现。
- **MQ最终一致性**：如阿里的RocketMQ支持消息事务。

## 面试题

- **分布式Session实现方案**：包括基于JWT的Token、基于Tomcat的Redis和基于Spring的Redis。